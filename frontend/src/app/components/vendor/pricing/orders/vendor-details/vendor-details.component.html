<div class="wrapper container-fluid">

  <div class="d-flex justify-content-between mt-4 align-items-center mb-2">
    <p class="part-header font-weight-bold">Accepted Order Details</p>
    <ng-container [ngSwitch]="type">
      <ng-container *ngSwitchCase="'release'">
        <button class="btn green-btn release-btn" (click)="showModal(content)">
          Release Sub Orders for Bidding
        </button>
      </ng-container>
      <ng-container *ngSwitchCase="'released'">
        <span class="text-green">Bidding Complete & Released</span>
      </ng-container>
      <ng-container *ngSwitchCase="'confirmation'">
        <p class="text-orange">
          Unresponsive time left before releasing to next supplier: 17:55:44
        </p>
        <p class="text-blue">Bidding In Progress</p>
      </ng-container>
      <ng-container *ngSwitchDefault>Ooops! Something went wrong!</ng-container>
    </ng-container>
  </div>

  <div class="row">
    <div class="col-12 theme-table ">
      <ag-grid-angular
        class="ag-theme-balham w-100 h-100"
        [rowData]="orderDetails"
        [gridOptions]="gridOptions[0]"
        (gridReady)="onGridReady(0, $event)"
        domLayout="autoHeight"
      ></ag-grid-angular>
    </div>
  </div>

  <div class="d-flex justify-content-between mt-4 align-items-center"  *ngIf="!bidOrderId">
    <p class="part-header font-weight-bold">Matching Suppliers Profiles</p>
    <ng-container [ngSwitch]="type">
      <ng-container *ngSwitchCase="'release'">
        <a class="priority-btn" (click)="toggleChangePriority()">{{changePriority ? "Confirm Priority" : "Change Priority"}}</a>
      </ng-container>
      <ng-container *ngSwitchCase="'released'"> </ng-container>
      <ng-container *ngSwitchDefault>Ooops! Something went wrong!</ng-container>
    </ng-container>
  </div>

  <div class="row" *ngIf="!bidOrderId">
    <div class="col-12 theme-table" *ngIf="changePriority; else plainMode">
      <ag-grid-angular
        class="ag-theme-balham w-100 h-100"
        [rowData]="priorityRows"
        [gridOptions]="gridOptions[1]"
        (gridReady)="onGridReady(1, $event)"
        [rowDragManaged]="true"
        [animateRows]="true"
        (rowDragEnd)="onRowDragEnd($event)"
        domLayout="autoHeight"
      ></ag-grid-angular>
    </div>
    <ng-template #plainMode>
      <div class="col-12 theme-table">
        <ag-grid-angular
          class="ag-theme-balham w-100 h-100"
          [rowData]="matchedProfiles"
          [gridOptions]="gridOptions[2]"
          (gridReady)="onGridReady(2, $event)"
          domLayout="autoHeight"
        ></ag-grid-angular>
      </div>
    </ng-template>
  </div>
  <div class="d-flex justify-content-between mt-4 align-items-center"  *ngIf="bidOrderId">
    <p class="part-header font-weight-bold">Bidding Status</p>
  </div>
  <div class="row" *ngIf="bidOrderId">
    <div class="col-12 theme-table bidding-orders">
      <ag-grid-angular
        class="ag-theme-balham w-100 h-100"
        [rowData]="bidding"
        [gridOptions]="gridOptions[4]"
        (gridReady)="onGridReady(4, $event)"
        domLayout="autoHeight"
      ></ag-grid-angular>
    </div>
  </div>
</div>

<ng-template #content let-modal>
  <div class="modal-container">
    <div class="modal-header">
      <h5 class="modal-title" id="modal-basic-title">
        Confirm Sub-Order Release
      </h5>
    </div>
    <div class="modal-container px-5 py-2">
      <div class="table">
        <div class="row header p-3">
          <div class="col-6">Pricing Information</div>
          <div class="col-6">Value</div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            Starting Release Price as % of Sale
          </div>
          <div class="setting-value p-3 col-6">
             % {{subOrderRelease.initialBidSoldPricePercent}}
          </div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            Initial Release Price
          </div>
          <div class="setting-value p-3 col-6">
            $ {{(initialPrice * (subOrderRelease.initialBidSoldPricePercent / 100)).toFixed(2)}}
          </div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            Release to How Many Suppliers at a Time
          </div>
          <div class="setting-value p-3 col-6">
            {{subOrderRelease.maxSupplierViewOpportunity}}
          </div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            Time Increment for Bid Increase if No vender accepts
          </div>
          <div class="setting-value p-3 col-6">
            {{subOrderRelease.minBidIncreaseTimeMinutes}} min
          </div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            Increase amount by
          </div>
          <div class="setting-value p-3 col-6">
            {{subOrderRelease.incrementBidAmountPercent}} %
          </div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            % of sale price without fullfillment to revert to customers
          </div>
          <div class="setting-value p-3 col-6">
            {{subOrderRelease.maxPercentWithoutFulfillment}}%
          </div>
        </div>
        <div class="row mb-1">
          <div class="setting-name p-3 col-6">
            Unresponsive time before releasing to next supplier
          </div>
          <div class="setting-value p-3 col-6">
            {{subOrderRelease.maxBidUnresponsiveTimeMinutes}} min
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal-footer d-flex p-3 align-items-center justify-content-around"
    >
      <button class="btn orange-btn" (click)="modal.dismiss()">Cancel</button>
      <button class="btn green-btn" (click)="confirmSubOrderRelease()">
        Confirm
      </button>
    </div>
  </div>
</ng-template>


<ng-template #pricingProfileModal let-modal>
  <div class="modal-container">
    <div class="modal-header">
      <h5 class="modal-title" id="modal-basic-title">
        {{pricingProfile?.vendorProfile?.name}} Profile
      </h5>
    </div>
    <div class="modal-container px-5 py-3">
      <p class="text-center">
        {{pricingProfile?.processProfileName}}
      </p>
      <div class="col-12 theme-table ">
        <ag-grid-angular
          class="ag-theme-balham w-100 h-100"
          [rowData]="pricingProfile?.pricing || []"
          [gridOptions]="gridOptions[3]"
          (gridReady)="onGridReady(3, $event)"
          domLayout="autoHeight"
        ></ag-grid-angular>
      </div>
    </div>
  </div>
</ng-template>
