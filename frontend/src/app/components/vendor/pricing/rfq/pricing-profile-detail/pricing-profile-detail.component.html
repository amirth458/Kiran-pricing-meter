<div class="wrapper container-fluid">
  <div
    class="header d-flex align-items-center mb-3"
    [ngClass]="{ 'manual-price': part?.manualPricingAllowed }"
  >
    <h5 class="text-center flex-grow-1">
      Part {{ part?.rfqMedia.projectRfqId + '.' + part?.id }}
    </h5>
    <button
      type="button"
      class="btn btn-back theme white"
      (click)="backButton()"
    >
      <i class="fas fa-chevron-left"></i>
      <span>
        Back
      </span>
    </button>
  </div>
  <div class="form-row">
    <div class="table theme-table">
      <ag-grid-angular
        class="ag-theme-balham"
        domLayout="autoHeight"
        [rowData]="rowData"
        [gridOptions]="gridOptions['partDetail']"
        (gridReady)="onGridReady($event, 'partDetail')"
      ></ag-grid-angular>
    </div>
    <div class="w-100 d-flex flex-row justify-content-end align-items-end mt-3">
      <button
        class="btn btn-primary"
        (click)="viewBreakDownInfo(breakDownModal)"
      >
        Show Prices
      </button>
    </div>
  </div>
  <div class="row">
    <div class="col-6">
      <div class="d-flex align-items-center justify-content-between mt-4">
        <span class="font-weight-bold ">Pricing Profile Detail</span>
      </div>
      <div class="round-border p-3 mt-2">
        <p>
          Pricing Profile Name: &nbsp;
          <span class="text-highlight">{{ pricingProfile?.name }}</span>
        </p>
        <p>
          Process Profile Name: &nbsp;
          <span class="text-highlight">{{
            pricingProfile?.processProfile.name
          }}</span>
        </p>
        <p>
          Pricing Parameter Set Nickname: &nbsp;
          <span class="text-highlight">{{
            pricingProfile?.processProfile.parameterNickName
          }}</span>
        </p>
      </div>
    </div>

    <div class="col-6">
      <div class="d-flex align-items-center justify-content-between mt-4">
        <span class="font-weight-bold">Conditions</span>
      </div>
      <div class="round-border p-3 mt-2">
        <p
          *ngFor="let condition of pricingProfile?.processPricingConditionList"
        >
          {{ condition.processPricingConditionType.name }}
          <mark>
            {{ condition.operatorType.symbol }}
            {{ condition.valueSignType.symbol }} {{ condition.value }}
            {{ condition.unitType.displayName }}
          </mark>
        </p>
      </div>
    </div>
  </div>

  <div class="round-border mt-3">
    <div class="d-flex justify-content-between header px-5">
      <span class="font-weight-bold active-tab d-flex align-items-center"
        >Process Parameters</span
      >
    </div>
    <div class="px-5 py-3 process-parameters">
      <!-- Flat Charges -->

      <div id="conditionLabel" class="tables">
        <div class="controls d-flex justify-content-between mb-1">
          <label for="conditionLabel">
            <b>Flat Charges</b>(These are base expenses associated with every
            project)
            <span
              class="icon"
              data-toggle="tooltip"
              data-placement="top"
              title="Examples include Non Recurring Engineering or Setup Expense"
            >
              <i class="fas fa-exclamation-circle"></i>
            </span>
          </label>
        </div>
        <!-- Insert Table here -->
        <div class="input-wrapper mb-3">
          <div class="form-row">
            <div class="table theme-table">
              <ag-grid-angular
                class="ag-theme-balham"
                domLayout="autoHeight"
                [rowData]="flatRowData"
                [gridOptions]="gridOptions['flatCharge']"
                (gridReady)="onGridReady($event, 'flatCharge')"
              ></ag-grid-angular>
            </div>
          </div>
        </div>
      </div>

      <!-- End of Flat Charges -->

      <!-- Variable Charges -->

      <div id="conditionLabel" class="tables">
        <div class="controls d-flex justify-content-between mb-1">
          <label for="conditionLabel"
            ><b>Variable Charges</b>(These are charges that increase with the
            size of a program)
            <span
              class="icon"
              data-toggle="tooltip"
              data-placement="top"
              title="Examples include material expense per unit column or cost per unit. 50 per cubic meter. $1/cubic inch"
            >
              <i class="fas fa-exclamation-circle"></i>
            </span>
          </label>
        </div>
        <!-- Insert Table here -->
        <div class="input-wrapper mb-3">
          <div class="form-row">
            <div class="table theme-table">
              <ag-grid-angular
                class="ag-theme-balham"
                domLayout="autoHeight"
                [rowData]="variableRowData"
                [gridOptions]="gridOptions['variableCharge']"
                (gridReady)="onGridReady($event, 'variableCharge')"
              ></ag-grid-angular>
            </div>
          </div>
        </div>
        <!-- Insert Table here -->
      </div>
      <!-- End of Variable Charges -->

      <!-- Multiplier Charges -->

      <div id="conditionLabel" class="tables">
        <div class="controls d-flex justify-content-between mb-1">
          <label for="conditionLabel">
            <b>Multiplier Charges</b>(These are cost considerations that are
            applied across one or more cost inputs)
            <span
              class="icon"
              data-toggle="tooltip"
              data-placement="top"
              title="Examples Include: Margin and Expedite Fees"
            >
              <i class="fas fa-exclamation-circle"></i>
            </span>
          </label>
        </div>
        <!-- Insert Table here -->
        <div class="input-wrapper">
          <div class="form-row">
            <div class="table theme-table">
              <ag-grid-angular
                class="ag-theme-balham"
                domLayout="autoHeight"
                [rowData]="multiplierRowData"
                [gridOptions]="gridOptions['multiplierCharge']"
                (gridReady)="onGridReady($event, 'multiplierCharge')"
              ></ag-grid-angular>
            </div>
          </div>
        </div>
      </div>
      <!-- End of Multiplier Charges -->
    </div>
  </div>
</div>

<ng-template #modal let-modal>
  <div class="modal-container">
    <div class="modal-header">
      <h5 class="modal-title" id="modal-basic-title">
        {{ pricingProfile?.name }}
      </h5>
      <button
        type="button"
        class="close"
        aria-label="Close"
        (click)="modal.dismiss()"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div
      class="modal-body d-flex flex-column align-items-center justify-content-center p-5"
    >
      <div class="row">
        <div class="col-12">
          <table class="table price-profile-table">
            <thead>
              <tr>
                <!-- <th>Invoice Group</th> -->
                <th>Invoice Item</th>
                <th>Invoice Line Item</th>
                <th>Value</th>
                <th>Per</th>
                <th>Part Value (unit)</th>
                <th>Suborder Value (unit)</th>
                <th>Invoice item cost</th>
                <th>Multiplier</th>
                <th>Final Invoice Item Cost</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of pricingList">
                <!-- <td>
                  {{ item.invoiceGroup }}
                </td> -->
                <td>
                  {{
                    item.processPricingParameters.invoiceLineItem.invoiceItem
                      .name
                  }}
                </td>
                <td>
                  {{ item.processPricingParameters.invoiceLineItem.name }}
                </td>
                <td class="text-center">
                  {{
                    item.processPricingParameters.price
                      | currency: 'USD':'symbol':'0.0-3'
                  }}
                </td>
                <td class="text-center">
                  {{ item.processPricingParameters.quantity }}
                </td>
                <td class="text-center">
                  {{
                    item.processPricingParameters.processPricingConditionType
                      ?.name
                      ? item.processPricingParameters
                          .processPricingConditionType?.name +
                        '(' +
                        item.processPricingParameters
                          .processPricingConditionType?.measurementType.name +
                        ')'
                      : ''
                  }}
                </td>
                <td class="text-center">
                  {{
                    item.subOrderValue?.value
                      ? item.subOrderValue?.value +
                        '(' +
                        item.subOrderValue?.measurementType?.name +
                        ')'
                      : ''
                  }}
                </td>
                <td class="text-center">
                  {{ item.invoiceItemCost | currency: 'USD':'symbol':'0.0-3' }}
                </td>
                <td class="text-center">
                  {{ item.processPricingParameters?.multiplier }}
                </td>
                <td class="text-center">
                  {{
                    item.finalInvoiceItemCost | currency: 'USD':'symbol':'0.0-3'
                  }}
                </td>
              </tr>
              <tr>
                <td colspan="6"></td>
                <td colspan="4" class="subtotal">
                  <table class="table table-responsive table-borderless">
                    <colgroup>
                      <col width="40%" />
                      <col width="30%" />
                      <col width="30%" />
                    </colgroup>
                    <tbody>
                      <tr *ngFor="let item of invoiceItemKeys">
                        <td>{{ item }}</td>
                        <td>
                          {{
                            totalInvoice[item].invoiceItemCost
                              | currency: 'USD':'symbol':'0.0-3'
                          }}
                        </td>
                        <td>
                          {{
                            totalInvoice[item].finalInvoiceItemCost
                              | currency: 'USD':'symbol':'0.0-3'
                          }}
                        </td>
                      </tr>
                      <tr class="font-weight-bold">
                        <th>TOTAL COST</th>
                        <td></td>
                        <td>
                          {{
                            finalInvoiceItemCost()
                              | currency: 'USD':'symbol':'0.0-3'
                          }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #breakDownModal let-modal>
  <div class="modal-container">
    <div class="modal-header">
      <h5 class="modal-title w-100 text-left pl-3 pr-2">
        Pricing Breakdown for the "{{ pricingProfile?.processProfile?.name }}"
        pricing profile
      </h5>
      <button
        type="button"
        class="close"
        data-dismiss="modal"
        aria-label="Close"
        (click)="modal.dismiss()"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div
      class="modal-body d-flex justify-content-center align-center overflow-auto"
      *ngIf="breakDownGridOptions?.length > 0"
    >
      <div class="col-12 pb-4">
        <h6 class="mb-3 mt-3">Cost Summary</h6>
        <div class="table theme-table" ngbAutofocus>
          <ag-grid-angular
            class="ag-theme-balham w-100 h-100"
            [rowData]="breakDownInfo?.costSummuryView"
            domLayout="autoHeight"
            (gridReady)="onBreakdownGridReady(0, $event)"
            [gridOptions]="breakDownGridOptions[0]"
          >
          </ag-grid-angular>
        </div>
        <h6 class="mb-3 mt-3">Cost Breakdown</h6>
        <div class="table theme-table mb-4">
          <ag-grid-angular
            class="ag-theme-balham w-100 h-100"
            [rowData]="breakDownInfo?.screenPricingBreakdownView"
            domLayout="autoHeight"
            (gridReady)="onBreakdownGridReady(1, $event)"
            [gridOptions]="breakDownGridOptions[1]"
          >
          </ag-grid-angular>
        </div>
      </div>
    </div>
  </div>
</ng-template>
