<div class="wrapper shadow text-theme">
  <!-- Prev-Next PO Navigation -->
  <!-- TODO: NOTE - Enable this section after we introduce previous and next button functionality  -->
  <div class="row justify-content-between purchase-nav" *ngIf="false">
    <div class="col-md-2 text-theme-green">
      <i class="fas fa-chevron-left"></i>
      <span class="ml-2">Previous PO</span>
    </div>
    <div class="col-md-2 row justify-content-end align-items-center text-theme-green">
      <span class="mr-2">Next PO</span>
      <i class="fas fa-chevron-right"></i>
    </div>
  </div>
  <!-- End of Prev-Next PO Navigation -->

  <div class="d-flex mt-4 justify-content-between detail-body">
    <div class="row flex-grow-1">
      <div class="col-7 details">
        <!-- Top Details Bar -->
        <div class="row justify-content-between info">
          <div class="col-5 mr-3 mb-3 p-3 order-info">
            <h5 class="font-weight-bold">
              Ordered on:
              <span class="text-theme-green">{{
                orderInfo?.customerOrder?.createdDate | date: 'MM/dd/yyyy':'UTC'
              }}</span>
            </h5>
            <p class="mb-1">
              Customer:
              <span class="text-theme-green font-weight-bold">{{ orderInfo?.customerOrder?.customerName }}</span>
            </p>
            <p class="">
              Order Id:
              <span class="text-theme-green font-weight-bold">{{ orderInfo?.billingInfoView?.orderId }}</span>
            </p>
          </div>

          <div class="col-6 p-3 mb-3 payment-info">
            <h5 class="font-weight-bold">
              Purchase Method:
              <span class="text-theme-green">
                {{ formatPaymentType(orderInfo?.billingInfoView?.paymentType) | titlecase }}
                <ng-container *ngIf="orderInfo?.billingInfoView?.purchaseAgreement">
                  (No{{ orderInfo?.billingInfoView?.purchaseAgreement?.poaNumber }})
                </ng-container>
              </span>
            </h5>
            <p class="mb-1">
              Paid:
              <span class="text-theme-green font-weight-bold">{{
                orderInfo?.billingInfoView?.amount | currency: ''
              }}</span>
            </p>
            <p
              class="text-theme-green file-name font-weight-bold"
              *ngIf="orderInfo?.billingInfoView?.purchaseAgreement"
            >
              <a [href]="orderInfo?.billingInfoView?.purchaseAgreement?.resourceUrl || ''" target="_blank">
                {{ orderInfo?.billingInfoView?.purchaseAgreement?.fileName || 'PO File' }}</a
              >
            </p>
          </div>
        </div>
        <!-- End of Top Details Bar -->
      </div>

      <!-- Summary -->
      <div class="col-5 summary">
        <!-- Top Summary -->
        <div class="p-3 order-summary">
          <h5>Order Summary</h5>
          <div *ngIf="showPaymentDetails" class="">
            <p class="d-flex mb-1 justify-content-between summary-item">
              <span class="name">Items</span>
              <span class="value">1,000</span>
            </p>
            <p class="d-flex mb-1 justify-content-between summary-item">
              <span class="name">Shipping and Handling</span>
              <span class="value">{{ '15.99' | currency: ' ' }}</span>
            </p>
            <p class="d-flex mb-1 justify-content-between summary-item">
              <span class="name">3Diligent Discount</span>
              <span class="value">{{ '-8.50' | currency: ' ' }}</span>
            </p>
            <p class="d-flex mb-1 justify-content-between summary-item">
              <span class="name">Total Before Tax</span>
              <span class="value">{{ '1027.49' | currency: ' ' }}</span>
            </p>
            <p class="d-flex mb-1 justify-content-between summary-item">
              <span class="name">Estimated Tax to be collected</span>
              <span class="value">{{ '371.50' | currency: ' ' }}</span>
            </p>
          </div>
          <h6 class="d-flex mt-2 justify-content-between summary-item">
            <span class="name">Total Cost</span>
            <span class="value">{{ orderInfo?.billingInfoView?.amount | currency: '$' }}</span>
          </h6>
          <br />
          <!-- TODO: -->
          <p *ngIf="false" class="details-toggle text-center" (click)="togglePaymentInfo()">
            <span *ngIf="showPaymentDetails">Close Details</span>
            <span *ngIf="!showPaymentDetails">See Details</span>
          </p>
        </div>
        <!-- End of Top Summary -->
      </div>
      <!-- End of Summary -->
    </div>
    <div *ngIf="orderInfo?.billingInfoView?.paymentType === paymentOrderType.PURCHASE_ORDER">
      <app-billing-chat [purchaseOrderId]="selectedPurchaseOrderId"></app-billing-chat>
    </div>
  </div>

  <div class="row" *ngIf="orderInfo?.billingInfoView.paymentStatusType === PaymentStatusTypes.WAITING_FOR_APPROVAL">
    <div class="col-12 mt-2 row justify-content-center">
      <button type="button" class="btn theme w-auto pl-5 pr-5" (click)="open(approveModal, 'md')">
        Approve
      </button>

      <button type="button" class="btn orange-btn w-auto ml-5 pl-5 pr-5" (click)="open(rejectModal, 'md')">
        Reject
      </button>
    </div>
  </div>
  <div class="row summary">
    <h5 class="col-12 pl-0">
      Parts
      <span (click)="open(partDetailsModal, 'xl')" class="ml-4 part-detail-toggle">See More Details</span>
    </h5>
    <div class="col-12 p-0 d-flex flex-wrap part-list">
      <div *ngFor="let item of orderInfo?.customerOrder?.partList" class="col-3 part-item mt-2">
        <p class="part-name">Part {{ item?.rfqMedia?.id }}.{{ item?.id }}</p>
        <!-- Image -->
        <img
          [src]="
            item?.rfqMedia?.media?.partDimension?.thumbnail200Location || '../../../../../assets/image/no-preview.jpg'
          "
          alt=""
          height="80px"
          width="80px"
        />
        <!-- Part Details -->
        <div class="details">
          <p class="d-flex mb-1 text-truncate" placement="auto" [ngbTooltip]="item?.rfqMedia?.media?.name">
            <span class="name">File: </span>
            <span class="value text-theme-green font-weight-bold">{{ item?.rfqMedia?.media?.name }}</span>
          </p>
          <p class="d-flex mb-1">
            <span class="name">Material: </span>
            <span class="value text-theme-green font-weight-bold">{{
              (item?.materialPropertyValues || []).join(', ')
            }}</span>
          </p>
          <p class="d-flex mb-1">
            <span class="name">Technology: </span>
            <span class="value text-theme-green font-weight-bold">{{
              (item?.equipmentPropertyValues || []).join(', ')
            }}</span>
          </p>
          <!-- <p class="d-flex mb-1">
            <span class="name">Post-Process: </span>
            <span class="value text-theme-green font-weight-bold">
              {{ preparePostProcessValues(item?.postProcessTypeIds) }}
            </span>
          </p> -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Approve Modal -->
<ng-template #approveModal let-modal>
  <div class="approveModal">
    <div class="modal-header">
      <h5 class="modal-title text-theme text-capitalize w-100 pl-3" id="modal-basic-title">
        Approve Purchase Order No {{ selectedPurchaseOrderId }}
      </h5>
      <button type="button" class="close" aria-label="Close" (click)="modal.close()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body text-theme">
      <p class="text-center">Do you want to Approve this Purchase Order ?</p>
    </div>

    <div class="modal-footer border-0" ngbAutofocus>
      <div class="w-100 row justify-content-center position-relative">
        <ng-container *ngIf="!loadingPanel; else loading">
          <div class="col-md-4">
            <button (click)="approve()" type="button" class="col btn theme">
              Approve
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>
<!-- End of Approve Modal -->

<!-- Reject Modal -->
<ng-template #rejectModal let-modal>
  <div class="rejectModal">
    <div class="modal-header">
      <h5 class="modal-title text-theme text-capitalize w-100 pl-3" id="modal-basic-title">
        Reject Purchase Order No {{ selectedPurchaseOrderId }}
      </h5>
      <button type="button" class="close" aria-label="Close" (click)="modal.close()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body text-theme">
      <p class="text-center">Do you want to Reject this Purchase Order ?</p>
    </div>

    <div class="modal-footer border-0" ngbAutofocus>
      <div class="w-100 row justify-content-center position-relative">
        <ng-container *ngIf="!loadingPanel; else loading">
          <div class="col-md-4">
            <button (click)="reject()" type="button" class="col btn theme orange-btn m-0">
              Reject
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>
<!-- End of Reject Modal -->

<ng-template #partDetailsModal let-modal>
  <div class="partDetailsModal">
    <div class="modal-header">
      <h5 class="modal-title text-theme text-capitalize w-100 pl-3">
        Order No {{ orderInfo?.billingInfoView?.orderId }}
      </h5>
      <button type="button" class="close" aria-label="Close" (click)="modal.close()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body text-theme">
      <app-part-item-details
        *ngFor="let part of orderInfo?.customerOrder?.partList"
        [postProcessAction]="postProcessAction"
        [part]="part"
        [measurementUnits]="measurementUnits"
      >
      </app-part-item-details>
    </div>

    <div class="modal-footer border-0" ngbAutofocus></div>
  </div>
</ng-template>

<ng-template #loading>
  <div class="d-flex justify-content-center align-items-center w-100 payment-panel">
    <ngx-spinner
      [name]="'spooler'"
      bdOpacity="0.7"
      bdColor="#fff"
      size="small"
      color="#74bf09"
      type="ball-clip-rotate"
      [fullScreen]="false"
    >
      <p class="m-0">Loading...</p>
    </ngx-spinner>
  </div>
</ng-template>
