<div class="wrapper">

  <form [formGroup]="form" class="needs-validation">

    <div class="container-fluid">
      <div class="row">

        <div class="col-md-3 image-section">
          <p>View in 3D</p>
          <div class="image">
            <img src="../../../../assets/image/example_machine.png" alt="image of a machine design" height="240px"
              width="240px">
          </div>

          <div class="tabs">
            <div class="d-flex justify-content-between align-items-center tab-header">
              <div class="d-flex align-items-center justify-content-center tab"
                [ngClass]="{'active':activeTab =='normal'}" (click)="toggleTab('normal')">Normal View</div>
              <div class="d-flex align-items-center justify-content-center tab"
                [ngClass]="{'active':activeTab =='tolerances'}" (click)="toggleTab('tolerances')">Tolerances</div>
            </div>
            <div class="tab-body p-2">
              <h6 class="text-theme">Brake Rotor No logo.step</h6>

              <!-- Normal Tab -->
              <ng-container *ngIf="activeTab =='normal'">
                <div class="normal">

                  <table class="text-theme">
                    <thead>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Part Dimensions:</td>
                        <td>12.36mm x 4.50mm x 4.73mm</td>
                      </tr>
                      <tr>
                        <td>Volume:</td>
                        <td>3.51cc</td>
                      </tr>
                    </tbody>
                  </table>

                  <button type="button" class="btn w-100 theme white">Change a Reference File</button>
                  <div class=" files d-flex  align-items-center mt-4">
                    <span class="mr-3 text-theme">Brake Rotor No logo.step</span>

                    <button class="close delete" type="button" (click)="onRemoveFile()"><i class="fas fa-trash"
                        color="red" aria-hidden="true"></i></button>
                  </div>
                </div>
              </ng-container>

              <!-- End of Normal Tab -->

              <!-- Tolerances Tab -->
              <ng-container *ngIf="activeTab=='tolerances'">
                <div class="tolerances">
                  <table class="text-theme">
                    <thead>
                    </thead>
                    <tbody>
                      <tr>
                        <td class=" font-weight-bold">Critical Tolerent 1:</td>
                        <td>6cm +/- 0.1cm</td>
                      </tr>
                      <tr>
                        <td class="font-weight-bold">Critical Tolerent 2:</td>
                        <td>15cm +/- 0.5cm</td>
                      </tr>
                      <tr>
                        <td class="font-weight-bold">Critical Tolerent 3:</td>
                        <td>6cm +/- 0.5cm</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </ng-container>
              <!-- End of Tolerances Tab -->
            </div>
          </div>
        </div>

        <div class=" col-md-9 row details-section">

          <div class="col-md-9">

            <div class="form-row">
              <div class="form-group theme col">
                <label for="partProfile">Part Profile</label>
                <select required id="partProfile" formControlName="partProfile" name="partProfile" class="form-control"
                  [ngClass]="{ 'is-invalid': submitted && f.partProfile.errors }">
                  <option selected value="null">Choose...</option>
                  <option *ngFor="let item of partProfileOptions" [value]="item.id">
                    {{item.name}}
                  </option>
                </select>

                <div *ngIf="submitted && f.rfqProfile.errors" class="invalid-feedback">
                  <div *ngIf="f.rfqProfile.errors.required">* Required</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Body -->
          <div class="col-md-12 body">
            <div class="table-form">
              <table class="table table-bordered h-100 text-theme rfq-table ">
                <thead>
                </thead>

                <tbody>
                  <tr>
                    <th scope="row">Quantity</th>
                    <td>
                      <input required type="number" maxlength="4" min="0" min="0" max="9999" class="form-control"
                        formControlName="quantity" id="quantity" name="quantity">
                    </td>
                  </tr>

                  <tr>
                    <th scope="row">Material</th>
                    <td>
                      <ng-select [multiple]="false" dropdownPosition="bottom" [virtualScroll]=" true"
                        [hideSelected]="true" [selectOnTab]="true" formControlName="material">
                        <ng-container *ngFor="let item of materialOptions">
                          <ng-option [disabled]="item.id == ''" [value]="item.id">{{item.name}}</ng-option>
                        </ng-container>
                      </ng-select>
                    </td>
                    <td class="border-white">
                      <button type="button" class="btn theme white">Material Tool</button>
                    </td>

                  </tr>

                  <tr>
                    <th scope="row">Process</th>
                    <td>
                      <ng-select [multiple]="false" dropdownPosition="bottom" [virtualScroll]=" true"
                        [hideSelected]="true" [selectOnTab]="true" formControlName="process">
                        <ng-container *ngFor="let item of processOptions">
                          <ng-option [disabled]="item.id == ''" [value]="item.id">{{item.name}}</ng-option>
                        </ng-container>
                      </ng-select>
                    </td>
                    <td class="border-white">
                      <button type="button" (click)="open(processTool)" class="btn theme white">Process Tool</button>
                    </td>

                  </tr>


                  <tr>
                    <th scope="row">Surface Roughness</th>
                    <td>
                      <div class="row">
                        <div class="col">
                          <select required id="boundingOk" formControlName="boundingOk" name="boundingOk"
                            class="form-control" [ngClass]="{ 'is-invalid': submitted && f.boundingOk.errors }">
                            <option selected value="null">Choose...</option>
                            <option *ngFor="let item of boundingOkOptions" [value]="item.id">
                              {{item.name}}
                            </option>
                          </select>
                        </div>
                        <div class="col">
                          <input required type="number" maxlength="4" min="0" min="0" max="9999" class="form-control"
                            formControlName="quantity" id="quantity" name="quantity">
                        </div>
                        <div class="col">
                          <select required id="boundingOk" formControlName="boundingOk" name="boundingOk"
                            class="form-control" [ngClass]="{ 'is-invalid': submitted && f.boundingOk.errors }">
                            <option selected value="null">Choose...</option>
                            <option *ngFor="let item of boundingOkOptions" [value]="item.id">
                              {{item.name}}
                            </option>
                          </select>
                        </div>
                      </div>
                    </td>

                  </tr>

                  <tr>
                    <th scope="row">Critical Tolerances 1</th>
                    <td>
                      <input required type="number" maxlength="4" min="0" min="0" max="9999" class="form-control"
                        formControlName="quantity" id="quantity" name="quantity">
                    </td>

                    <td class="border-white">
                      <button type="button" class="btn theme white">Material Tool</button>
                    </td>

                  </tr>

                  <tr>
                    <th scope="row">Critical Tolerances 2</th>
                    <td>
                      <input required type="number" maxlength="4" min="0" min="0" max="9999" class="form-control"
                        formControlName="quantity" id="quantity" name="quantity">
                    </td>



                  </tr>

                  <tr>
                    <th scope="row">Critical Tolerances 3</th>
                    <td>
                      <input required type="number" maxlength="4" min="0" min="0" max="9999" class="form-control"
                        formControlName="quantity" id="quantity" name="quantity">
                    </td>



                  </tr>

                  <tr>
                    <th scope="row">Target Delivery Date</th>
                    <td>
                      <p (click)="open(content)" class="mb-0 d-flex align-items-center h-100 pl-3">
                        <span *ngFor="let shipment of deliveryDates; let index = index" class="mr-2">
                          <ng-container *ngIf="shipment.date.month && shipment.quantity">
                            {{shipment.date.day}}/{{shipment.date.month}}/{{shipment.date.year}} <span
                              class="text-theme-green">({{shipment.quantity}})</span>
                          </ng-container>
                        </span>

                      </p>
                    </td>



                  </tr>

                  <tr>
                    <th scope="row">Post-Process Actions</th>
                    <td>
                      <ng-select [multiple]="true" dropdownPosition="bottom" [virtualScroll]=" true"
                        [hideSelected]="true" [selectOnTab]="true" formControlName="postProcessActions">
                        <ng-container *ngFor="let item of postProcessActionOptions">
                          <ng-option [disabled]="item.id == ''" [value]="item.id">{{item.name}}</ng-option>
                        </ng-container>
                      </ng-select>
                    </td>

                    <td class="border-white">
                      <button type="button" (click)="open(postProcessAction)" class="btn theme white">Post-Process Tool</button>
                    </td>


                  </tr>

                  <tr>
                    <th scope="row">Cutting/Bonding OK</th>
                    <td>
                      <select required id="boundingOk" formControlName="boundingOk" name="boundingOk"
                        class="form-control" [ngClass]="{ 'is-invalid': submitted && f.boundingOk.errors }">
                        <option selected value="null">Choose...</option>
                        <option *ngFor="let item of boundingOkOptions" [value]="item.id">
                          {{item.name}}
                        </option>
                      </select>
                    </td>



                  </tr>

                </tbody>
              </table>
            </div>
          </div>
          <!-- End of Body -->

          <!-- Footer -->
          <div class="col-md-12 mt-4 row footer">
            <div class="col-md-5">

            </div>
            <div class="col-md-3 row">
              <button type="button" class="col btn theme white">Copy to All RFQs Parts</button>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3 row">
              <button type="button" class="col btn theme">Save as Part Profile</button>
            </div>
          </div>
          <!-- End of Footer -->

        </div>

      </div>
    </div>


    <!-- Shipment Modal   -->
    <ng-template #content let-modal>
      <div class="deliveryModal">
        <div class="modal-header">
          <h4 class="modal-title text-theme-green text-capitalize text-center" id="modal-basic-title">123.1 Rotor</h4>
          <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">

          <div class="progress-bar-section">
            <p class="text-theme">
              Quantity to Delivery <span class="text-theme-green"> ( {{selectedDeliveryItemCount}} / {{quantity}}
                )</span>
              <ngb-progressbar type="success" [value]="(selectedDeliveryItemCount * 100)/quantity"></ngb-progressbar>
            </p>
          </div>
          <table class="table text-theme">
            <thead>
              <tr>
                <th scope="col">Shipment Name</th>
                <th scope="col">Quantity</th>
                <th scope="col">Target Delivery Date</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let shipment of deliveryDates; let index = index">
                <td>Shipment {{index + 1}}</td>
                <td>
                  <input required [(ngModel)]="deliveryDates[index].quantity" [ngModelOptions]="{standalone: true}"
                    type="number" maxlength="4" min="0" min="0" max="9999" class="form-control"
                    [id]="'quantity' + index + 1" [name]="'quantity' + index + 1">
                </td>
                <td>
                  <div class="input-group">
                    <input id="dateOfBirth" class="form-control" [(ngModel)]="deliveryDates[index].date"
                      [ngModelOptions]="{standalone: true}" placeholder="yyyy-mm-dd" [name]="'shipment' + index + 1"
                      ngbDatepicker #shipment1="ngbDatepicker">
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary calendar" (click)="shipment1.toggle()" type="button">
                        <i class="fa fa-calendar" aria-hidden="true"></i>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>

            </tbody>
          </table>


        </div>
        <div class="modal-footer row">
          <div class="col-md-3">
            <button type="button" class="btn theme" (click)="modal.close('Save click')">Close</button>
          </div>
        </div>

      </div>
    </ng-template>

    <!-- End of Shipment Modal   -->


    <!-- Process Tool Modal -->
    <ng-template #processTool let-modal>
      <div class="processToolModal">
        <div class="modal-header">
          <h4 class="modal-title text-theme-green text-capitalize text-center" id="modal-basic-title">Process Search
            Tool</h4>
          <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>


        <div class="modal-body">
          <div class="row search">
            <div class="col-md-2"></div>

            <div class="col-md-8">
              <div class="d-flex input">
                <input type="text" (keyup)="onPartToolSearch($event)" class="form-control shadow white" id="quantity"
                  name="quantity">
                <div class="icon search-icon">
                  <i class="fas fa-search"></i>
                </div>
              </div>

              <div *ngIf="processOptionsFiltered.length" class="shadow mt-4 p-3 text-theme options">
                <ng-container *ngFor="let option of processOptionsFiltered">
                  <div (click)="selectProcess(option.id)" class="option-item active"
                    [ngClass]="{'active':this.form.value.process == option.id}">
                    <p class="m-2 p-2">{{option.name}}</p>
                  </div>
                </ng-container>
              </div>
            </div>

            <div class="col-md-2"></div>

          </div>
        </div>

        <div class="modal-footer row justify-content-center">
          <div class="col-md-4">
            <button type="button" [disabled]="!this.form.value.process" (click)="modal.close()"
              class="col btn theme">Confirm</button>
          </div>
        </div>

      </div>
    </ng-template>
    <!-- End of Process Tool Modal -->




    <!-- Process Tool Modal -->
    <ng-template #postProcessAction let-modal>
      <div class="postProcessAction">
        <div class="modal-header">
          <h4 class="modal-title text-theme-green text-capitalize text-center" id="modal-basic-title">Post-Process
            Search Tool</h4>
          <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>


        <div class="modal-body">
          <div class="row search">
            <div class="col-md-4"></div>

            <div class="col-md-4 options shadow p-2 text-theme">
              <div class="row m-2" *ngFor="let column of postProcessActionOptions; let index=index">
                <div class="col-2">
                  <span class="icon text-theme-green" *ngIf="column.checked" (click)="togglePostProcessCheck(index)">
                    <i class="fas fa-check-square"></i>
                  </span>

                  <span class="icon text-theme-green" *ngIf="!column.checked" (click)="togglePostProcessCheck(index)">
                    <i class="far fa-square"></i>
                  </span>
                </div>

                <div class="col-10 column-name">
                  <span style="margin-top: -3px" title="{{column.name}}">
                    {{column.name}}
                  </span>
                </div>

              </div>

            </div>

            <div class="col-md-4"></div>

          </div>
        </div>

        <div class="modal-footer row justify-content-center">
          <div class="col-md-4">
            <button type="button" [disabled]="this.form.value.postProcessActions? !this.form.value.postProcessActions.length: true" (click)="modal.close()"
              class="col btn theme">Confirm</button>
          </div>
        </div>

      </div>
    </ng-template>
    <!-- End of Process Tool Modal -->





  </form>

</div>
