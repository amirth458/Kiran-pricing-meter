<div class="wrapper container-fluid p-4">
  <ng-container *ngIf="isComplete()">
    <div class="d-flex flex-row justify-content-start align-items-center pt-2 pb-2">
      <h5 class="m-0 text-theme w-100 d-flex flex-row">
        Submitted Proposal
        <span class="ml-auto btn-close" (click)="hideDetailView(true)">
          <i class="fa fa-times" aria-hidden="true"></i>
        </span>
      </h5>
    </div>
    <div class="part-list pt-2 pb-3">
      <div class="w-100 row">
        <header class="col-12 feature-header d-flex flex-row">
          <h6 class="title pl-0 text-theme">
            Project Details
          </h6>
          <span
            *ngIf="adminProposalInfo"
            class="ml-3 font-sm cursor-pointer font-weight-normal underline"
            (click)="showPartDetails = !showPartDetails"
          >
            See <ng-container *ngIf="showPartDetails">less</ng-container>
            <ng-container *ngIf="!showPartDetails">more</ng-container> details
          </span>
        </header>
        <ng-container *ngIf="!showPartDetails">
          <app-part-list [showRefFile]="true" [parts]="adminProposalInfo"></app-part-list>
        </ng-container>
      </div>
    </div>
    <div class="part-details w-100">
      <ng-container *ngIf="showPartDetails">
        <app-prod-part
          class="d-block mt-4 mb-4"
          *ngFor="let part of adminProposalInfo"
          [partId]="part.partId"
          [unitOptions]="measurementUnits"
        >
        </app-prod-part>
      </ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="!isComplete()">
    <div class="d-flex flex-row justify-content-start align-items-center pt-2 pb-2">
      <h5 class="m-0 text-theme w-100 d-flex flex-row">
        {{ proposalType === proposalTypeEnum.ADMIN_PROPOSAL_TYPE ? 'Admin Proposal' : 'Vendor Proposal' }}
        <span class="ml-auto btn-close" (click)="hideDetailView()">
          <i class="fa fa-times" aria-hidden="true"></i>
        </span>
      </h5>
    </div>
  </ng-container>

  <ng-container *ngIf="!isComplete()">
    <div class="d-flex flex-row justify-content-start align-items-center pt-2 pb-2">
      <h6 class="m-0 text-theme total-price">Total Price {{ totalCost || 0 | currency: 'USD':'symbol':'0.0-3' }}</h6>
      <div class="ml-auto d-flex align-items-center" *ngIf="proposalTypeEnum.ADMIN_PROPOSAL_TYPE === proposalType">
        <div class="communication" *ngIf="isReleaseToSingleSupplier !== null && customer && activePartId">
          <app-admin-communication
            [allowScheduling]="true"
            [zoomType]="isReleaseToSingleSupplier ? zoomTypeEnum?.CUSTOMER_ORDER : zoomTypeEnum?.PART"
            [zoomAttachingUserId]="customer.userId"
            [zoomAttachingId]="isReleaseToSingleSupplier ? customerOrderId : activePartId"
            [chatAttachingId]="isReleaseToSingleSupplier ? customerOrderId : activePartId"
            [zoomParticipant]="zoomParticipantEnum?.CUSTOMER"
            [chatType]="isReleaseToSingleSupplier ? chatTypeEnum?.CUSTOMER_ORDER : chatTypeEnum?.PART_NOTE"
            [allowNotes]="true"
          >
          </app-admin-communication>
        </div>

        <button (click)="deleteAdminProposal()" class="btn btn-white text-orange del-proposal pl-4 pr-4 w-auto ml-2">
          Delete Proposal
        </button>
        <button (click)="updateAdminProposal()" class="btn theme btn-white pl-4 pr-4 w-auto ml-2">
          Save the Proposal
        </button>
        <button (click)="sendAllQuoteToCustomer()" class="btn theme btn-primary pl-4 pr-4 w-auto ml-2">
          Send All Quotes to Customer
        </button>
      </div>
      <div class="ml-auto d-flex align-items-center" *ngIf="proposalTypeEnum.VENDOR_PROPOSAL_TYPE === proposalType">
        <div class="communication">
          <app-admin-communication
            *ngIf="bidPmProjectProcessId"
            [allowScheduling]="true"
            [zoomType]="zoomTypeEnum?.BID_PM_PROJECT_PROCESS"
            [zoomAttachingUserId]="vendorId"
            [zoomAttachingId]="bidPmProjectProcessId"
            [chatAttachingId]="bidPmProjectProcessId"
            [zoomParticipant]="zoomParticipantEnum?.VENDOR"
            [chatType]="chatTypeEnum?.BID_PM_PROJECT_PROCESS"
            [allowNotes]="true"
          >
          </app-admin-communication>
        </div>

        <button class="btn theme btn-primary pl-4 pr-4 w-auto ml-2 h-25" (click)="createAdminProposal()">
          Copy Vendor Quote Details To Appropriate Customer PM RFQ
        </button>
      </div>
    </div>
    <div
      *ngIf="releasedProposal && proposalType === proposalTypeEnum.ADMIN_PROPOSAL_TYPE"
      class="d-flex flex-row justify-content-start align-items-center pt-2 pb-2"
    >
      <div>
        <span class="text-light-blue text-underlined">
          Assign Vendor:
        </span>
        <span class="text-theme">
          {{ releasedProposal.vendorName }}
        </span>
      </div>
      <div class="pl-3 pr-3">
        <a class="text-theme text-underlined" href="javascript:void(0)" (click)="viewVendorProposal()">
          Vendor Proposal
        </a>
      </div>
    </div>
  </ng-container>

  <div class="d-flex">
    <ngb-tabset
      class="w-100"
      [destroyOnHide]="true"
      [justify]="'start'"
      (tabChange)="beforeChange($event)"
      *ngIf="(quoteList?.length || 0) > 0"
    >
      <ngb-tab *ngFor="let quote of quoteList" [id]="quote.partId.toString()">
        <ng-template ngbTabTitle> Part {{ quote?.partId }} </ng-template>
        <ng-template ngbTabContent>
          <div class="d-flex flex-column pl-2 pr-2">
            <ng-container *ngIf="!isComplete()">
              <div class="d-flex flex-row pt-2 pb-2">
                <h5 class="m-0 pt-3 pb-2 text-theme">
                  Customer Requirement:
                </h5>
                <div class="ml-auto" *ngIf="proposalType === proposalTypeEnum.ADMIN_PROPOSAL_TYPE">
                  <button
                    (click)="sendQuote(quote.vendorId, [quote?.partId])"
                    class="btn btn-sm theme btn-white pl-4 pr-4 w-auto"
                  >
                    Send Quote to Customer
                  </button>
                </div>
              </div>
              <app-prod-part [unitOptions]="measurementUnits" [partId]="quote.partId" [title]="false"> </app-prod-part>
            </ng-container>
            <h5 class="m-0 pt-3 pb-2 text-theme">
              PM Proposal to Customer:
            </h5>
            <ngb-tabset>
              <ngb-tab [id]="'requirements'">
                <ng-template ngbTabTitle> Requirements </ng-template>
                <ng-template ngbTabContent>
                  <div class="d-flex flex-column" *ngIf="partInfo[quote.proposalPartId] as part">
                    <div class="d-flex flex-wrap col-12">
                      <div class="col-6">
                        <div class="col-12 d-flex flex-row">
                          <div class="col-4">
                            <div class="media-image" [ngStyle]="getMediaBackgroundImage(part?.rfqMedia)"></div>
                          </div>
                          <div class="col-8 pt-5">
                            <p class="text-theme label-value font-weight-bold text-wrap">
                              {{ part?.rfqMedia?.media?.name }}
                            </p>
                            <p class="text-theme label-value">Part Dimensions - {{ getDimension(part?.rfqMedia) }}</p>
                            <p class="text-theme label-value">
                              Volume - {{ getVolume(part?.rfqMedia?.media?.partDimension) }}
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="col-6">
                        <table class="proposal-table mt-3 mb-2">
                          <tbody>
                            <tr>
                              <td class="high-lighted-cell">Quantity</td>
                              <td class="proposed-value">
                                {{ part.quantity || '' }}
                              </td>
                            </tr>
                            <tr>
                              <td class="high-lighted-cell">Material</td>
                              <td class="proposed-value">
                                {{ (part.materialPropertyValues || []).join(',') }}
                              </td>
                            </tr>
                            <tr>
                              <td class="high-lighted-cell">Technology</td>
                              <td class="proposed-value">
                                {{ (part.equipmentPropertyValues || []).join(',') }}
                              </td>
                            </tr>
                            <tr>
                              <td class="high-lighted-cell">Target Delivery</td>
                              <td class="proposed-value">
                                {{ part.targetDeliveryDate | date: 'MM/dd/yyyy':'UTC' }}
                              </td>
                            </tr>
                            <tr>
                              <td class="high-lighted-cell">Reference Files</td>
                              <td class="proposed-value">
                                <app-ref-file [value]="part.id" [showNames]="true"></app-ref-file>
                              </td>
                            </tr>
                            <tr>
                              <td class="high-lighted-cell">Additional Assurances</td>
                              <td class="proposed-value">
                                {{ part?.comments }}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </ngb-tab>
              <ngb-tab [id]="'quote'">
                <ng-template ngbTabTitle> Quote </ng-template>
                <ng-template ngbTabContent>
                  <div class="pt-4 pb-4">
                    <h6 class="text-theme">Enter the price or use your pricing profiles below</h6>
                    <app-customer-part-quote
                      class="w-50"
                      [editable]="isQuoteEditable()"
                      [invoiceItems]="invoiceItems"
                      [(quote)]="quote"
                    >
                    </app-customer-part-quote>
                  </div>
                </ng-template>
              </ngb-tab>
              <ng-container *ngIf="showProfilesTab()">
                <ngb-tab [id]="'relatedProcessProfiles'">
                  <ng-template ngbTabTitle> Related Process Profiles </ng-template>
                  <ng-template ngbTabContent>
                    <ng-container *ngIf="partInfo[quote.proposalPartId] as part">
                      <div class="d-flex flex-column pt-4 pb-4">
                        <app-process-profile [part]="part" [rowData]="processProfiles"> </app-process-profile>
                      </div>
                    </ng-container>
                  </ng-template>
                </ngb-tab>
                <ngb-tab [id]="'relatedPricingProfiles'">
                  <ng-template ngbTabTitle> Related Pricing Profiles </ng-template>
                  <ng-template ngbTabContent>
                    <ng-container *ngIf="partInfo[quote.proposalPartId] as part">
                      <div class="d-flex flex-column pt-4 pb-4">
                        <app-pricing-profile [part]="part" [rowData]="pricingProfiles"> </app-pricing-profile>
                      </div>
                    </ng-container>
                  </ng-template>
                </ngb-tab>
              </ng-container>
            </ngb-tabset>
          </div>
        </ng-template>
      </ngb-tab>
    </ngb-tabset>
  </div>
</div>

<ng-template #overWriteModal let-modal>
  <div class="modal-container">
    <div class="modal-body d-flex flex-column align-items-center justify-content-center p-5">
      <div class="row">
        <div class="modal-header d-flex justify-content-center pt-4 pb-4 w-100 text-theme-green">
          <h5 class="modal-title">
            There is already data stored in the admin proposal
          </h5>
        </div>
        <p class="text-theme w-100 text-center mt-4 mb-4">
          Do you want to overwrite?
        </p>
        <div class="d-flex flex-row w-100 justify-content-center align-items-center pt-4 pb-2" ngbAutofocus>
          <button type="button" class="btn theme btn-orange w-auto pl-5 pr-5" (click)="modal.dismiss()">
            Cancel
          </button>
          <button (click)="createProposal()" type="button" class="btn theme green w-auto pl-5 pr-5 ml-3">
            Overwrite
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>
