<div class="d-flex flex-column w-100 table theme-table released-bid-grids">
  <div class="d-flex header justify-content-between align-items-center pb-2">
    <h6 class="text-theme">Matching Suppliers Queue</h6>
    <div>
      <button
        class="btn btn-white pl-4 pr-4"
        [disabled]="(gridOptions?.api?.getSelectedRows()?.length || 0) === 0"
        (click)="sendMail()"
      >
        <small> <i class="far fa-envelope"></i>&nbsp; Send Mail </small>
      </button>
      <button
        class="btn btn-white pl-4 pr-4 ml-2"
        (click)="viewAdminProposal()"
        *ngIf="(adminProposalInfo?.length || 0) > 0"
      >
        <span class="text-theme">Admin Proposal</span>
      </button>
      <button class="btn btn-white pl-4 pr-4 ml-2">
        Add New Supplier
      </button>
    </div>
  </div>
  <div class="ag-theme-balham w-100 h-100 position-relative bid-order-grid">
    <ag-grid-angular
      class="ag-theme-balham w-100 h-100"
      [class.empty]="(rowData || []).length === 0"
      [gridOptions]="gridOptions"
      [rowData]="rowData"
      [domLayout]="'autoHeight'"
      (gridReady)="onGridReady($event)"
    >
    </ag-grid-angular>
    <ngx-spinner
      [name]="'releaseLoadingPanel'"
      bdColor="#ffffff70"
      size="small"
      color="#74bf09"
      type="ball-clip-rotate"
      [fullScreen]="false"
    >
      <p class="m-0">Loading...</p>
    </ngx-spinner>
  </div>
</div>

<ng-template #sendMailModal let-modal>
  <app-send-mail-modal [from]="from" [to]="to" [cc]="cc" [bcc]="bcc" (close)="modal.dismiss()"></app-send-mail-modal>
</ng-template>

<ng-template #additionalColDefRef let-row>
  <div class="d-flex flex-row justify-content-start align-items-center">
    <a
      href="javascript:void(0);"
      class="text-theme-green"
      *ngIf="proposalInfo[row?.vendorId] && (proposalInfo[row?.vendorId]?.proposalPartIds || []).length > 0"
      (click)="viewVendorOffer($event, row?.vendorId)"
    >
      View Proposal
    </a>
    <span class="delete ml-3 mr-3">
      <i class="fas fa-copy"></i>
    </span>
  </div>
</ng-template>

<ng-template #communicationCell let-row>
  <div class="d-flex flex-row justify-content-around align-items-center h-100 w-100">
    <app-chat
      [participants]="row.vendorUserId ? [row.vendorUserId] : []"
      [id]="row.bidPmProjectProcessId"
      [type]="chatTypeEnum.BID_PM_PROJECT_PROCESS"
      [value]="chat"
      (valueChange)="chat = $event"
    >
    </app-chat>

    <!-- Zoom Communication -->
    <ng-container>
      <label class="text-theme-green  text-btn pt-2 picker-icon" (click)="openDateTimeSelector(row)">
        <i class="far fa-calendar-alt"></i>
        <input
          *ngIf="meetingInfo[row.vendorUserId]"
          class="dt-control m-0 p-0"
          readonly
          #dateTimeSelector2
          [owlDateTime]="dt2"
          [owlDateTimeTrigger]="dt2"
          [(ngModel)]="meetingInfo[row.vendorUserId].startTime"
          [ngModelOptions]="{ standalone: true }"
          (ngModelChange)="onTimeChanged($event)"
        />
        <owl-date-time #dt2></owl-date-time>
      </label>
      <div
        class="d-flex meeting-time position-relative text-center d-flex align-items-center"
        (click)="openDateTimeSelector(row)"
      >
        <span class="d-flex flex-column justify-content-center align-items-center m-0">
          <span class="m-0 text-center ">
            Meeting Time
          </span>
          <span
            class="font-weight-bold time text-center"
            [ngClass]="{
              'theme-grey': meetingInfo[row.vendorUserId]?.isExpired || !meetingInfo[row.vendorUserId]?.startTime
            }"
          >
            <a
              *ngIf="meetingInfo[row.vendorUserId]?.startTime"
              [href]="
                user?.id == meetingInfo[row.vendorUserId].hostUserId
                  ? meetingInfo[row.vendorUserId]?.videoConferenceLinkForHost
                  : meetingInfo[row.vendorUserId]?.videoConferenceLinkForParticipant
              "
              target="_blank"
              class="underline"
            >
              {{ meetingInfo[row.vendorUserId]?.startTime | date: 'short' }}
            </a>
            <ng-container *ngIf="!meetingInfo[row.vendorUserId]?.startTime">
              -
            </ng-container>
          </span>
          <input
            *ngIf="meetingInfo[row.vendorUserId]"
            class="dt-control m-0 p-0"
            readonly
            #dateTimeSelector
            [owlDateTime]="dt1"
            [owlDateTimeTrigger]="dt1"
            [(ngModel)]="meetingInfo[row.vendorUserId].startTime"
            [ngModelOptions]="{ standalone: true }"
            (ngModelChange)="onTimeChanged($event)"
          />
        </span>
      </div>
      <owl-date-time #dt1></owl-date-time>
    </ng-container>
    <!-- End of Zoom Communication -->
  </div>
</ng-template>
