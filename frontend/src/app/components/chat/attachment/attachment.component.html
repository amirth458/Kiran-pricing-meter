<button
  #content
  class="attachment btn btn-white pl-3 pr-3 text-theme-green"
  [class.d-none]="(content?.children?.length || 0) === 0"
  (click)="openFileManager(attachmentTemplate)"
>
  <ng-content> </ng-content>
</button>

<button
  *ngIf="(content?.children?.length || 0) === 0"
  class="attachment btn btn-white pl-3 pr-3 text-theme-green"
  (click)="openFileManager(attachmentTemplate)"
>
  <i class="fas fa-paperclip"></i>
</button>

<ng-template #attachmentTemplate let-modal>
  <div class="container-fluid d-flex h-100 flex-column">
    <ng-container>
      <div class="modal-header">
        <h4 class="text-center text-theme-green w-100 text-left pl-3 pr-2 font-weight-bold">
          Upload a File
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body container-fluid d-flex flex-column">
        <div class="col-12 d-flex p-0" ngbAutofocus>
          <ngb-tabset [destroyOnHide]="false" [justify]="'Fill'" class="w-100 d-block">
            <ngb-tab title="File Manager">
              <ng-template ngbTabContent>
                <div
                  class="upload-container d-flex flex-column position-relative align-items-center {{
                    (files?.length || 0) > 0 ? 'justify-content-start has-files' : 'justify-content-center'
                  }}"
                  appDnd
                  (fileDropped)="fileDropped($event)"
                >
                  <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="true">
                    <ng-container *ngIf="files.length === 0">
                      <input
                        class="file-picker"
                        type="file"
                        #fileDropRef
                        id="fileDropRef"
                        multiple
                        (change)="fileChangeHandler($event)"
                      />
                      <svg xmlns="http://www.w3.org/2000/svg" width="63" height="64" viewBox="0 0 63 64">
                        <use xlink:href="#upload-icon" />
                      </svg>
                      <h3 class="mt-3 mb-3">Drag and drop file here</h3>
                      <h3 class="mb-3">or</h3>
                      <label class="btn btn-primary w-auto pl-5 pr-5 btn-browse" for="fileDropRef">
                        Browse for file
                      </label>
                    </ng-container>
                    <div
                      class="files-list d-flex flex-row flex-wrap justify-content-around position-relative"
                      *ngIf="(files?.length || 0) > 0"
                    >
                      <div class="single-file m-2" *ngFor="let file of files; let i = index">
                        <div class="file-icon text-theme-green">
                          <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="info">
                          <h4 class="name">
                            {{ file?.name }}
                          </h4>
                          <p class="size">
                            {{ formatBytes(file?.size) }}
                          </p>
                        </div>
                        <div class="delete" (click)="deleteFile(i)">
                          <i class="fas fa-trash"></i>
                        </div>
                      </div>
                    </div>
                  </perfect-scrollbar>
                  <div
                    class="d-flex flex-row justify-content-center align-items-center w-100 pt-3 pb-3"
                    *ngIf="(files?.length || 0) > 0"
                  >
                    <label class="btn btn-white w-auto pl-5 pr-5">
                      <input type="file" class="d-none" (change)="fileChangeHandler($event)" />
                      Add Files
                    </label>
                    <label class="btn btn-primary w-auto pl-5 pr-5 m-0 ml-3 border-0" (click)="upload()">
                      Upload
                    </label>
                  </div>
                </div>
              </ng-template>
            </ngb-tab>
            <ngb-tab *ngFor="let u of users">
              <ng-template ngbTabTitle>
                Uploaded By {{ u.id === user.id ? 'You' : u.firstName + ' ' + u.lastName }}
              </ng-template>
              <ng-template ngbTabContent>
                <div class="file-container d-flex flex-column pt-3 pb-3">
                  <ul
                    class="file-items d-flex flex-wrap w-100"
                    *ngIf="attachments | userAttachments: u.id as userFiles"
                  >
                    <li
                      class="d-flex flex-column justify-content-center align-items-center m-2"
                      *ngFor="let file of userFiles"
                    >
                      <a [href]="file.location" [target]="'_blank'" [rel]="'noopener'">
                        <a class="list-item rounded d-flex justify-content-center align-items-center">
                          <span class="doc-icon text-theme-green">
                            <i class="far fa-file-alt"></i>
                          </span>
                        </a>
                        <div class="col-12 p-0 m-0 d-flex flex-row">
                          <a
                            class="col-10 p-0 file-name"
                            [href]="file.location"
                            [target]="'_blank'"
                            [rel]="'noopener'"
                            >{{ file.name }}</a
                          >
                          <span class="delete col p-0" *ngIf="u.id === user.id" (click)="delete($event, file.id)">
                            <i class="fas fa-trash"></i>
                          </span>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
              </ng-template>
            </ngb-tab>
          </ngb-tabset>
        </div>
      </div>
    </ng-container>
  </div>

  <svg class="d-none">
    <symbol id="upload-icon">
      <g fill="#74bf09" fill-rule="nonzero">
        <path
          d="M42.656 15.135a1.953 1.953 0 0 1-1.391-.578L31.5 4.795l-9.765 9.762a1.97 1.97 0 1 1-2.785-2.785L30.106.616a1.97 1.97 0 0 1 2.785 0l11.157 11.156a1.97 1.97 0 0 1-1.392 3.363z"
        />
        <path
          d="M31.5 36.791a1.97 1.97 0 0 1-1.969-1.969V2.01a1.97 1.97 0 0 1 3.938 0v32.812a1.97 1.97 0 0 1-1.969 1.969z"
        />
        <path
          d="M55.781 63.041H7.22A7.225 7.225 0 0 1 0 55.822V41.385a4.599 4.599 0 0 1 4.594-4.594h7.234a4.567 4.567 0 0 1 4.402 3.276l2.814 9.382a.658.658 0 0 0 .628.467h23.656a.658.658 0 0 0 .628-.467l2.814-9.385a4.572 4.572 0 0 1 4.402-3.273h7.234A4.599 4.599 0 0 1 63 41.385v14.437a7.225 7.225 0 0 1-7.219 7.219zM4.594 40.729a.656.656 0 0 0-.657.656v14.437a3.286 3.286 0 0 0 3.282 3.282H55.78a3.286 3.286 0 0 0 3.282-3.282V41.385a.656.656 0 0 0-.657-.656h-7.234a.65.65 0 0 0-.628.467L47.73 50.58a4.628 4.628 0 0 1-4.402 3.274H19.672a4.567 4.567 0 0 1-4.402-3.276l-2.814-9.382a.65.65 0 0 0-.628-.467H4.594z"
        />
      </g>
    </symbol>
  </svg>
</ng-template>
