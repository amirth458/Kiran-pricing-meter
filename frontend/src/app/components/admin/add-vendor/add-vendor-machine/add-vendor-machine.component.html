<div class="row">
  <div class="col-12">
    <div class="wrapper shadow">
      <div *ngIf="error.length > 1" class="alert alert-danger" role="alert">
        {{ error }}
      </div>
      <form [formGroup]="form" novalidate class="needs-validation" (submit)="add($event)">
        <div class="form-row">
          <div class="form-group theme col-md-6">
            <label for="machineName">Machine Name<span class="asterix">*</span></label>
            <input
              required
              type="text"
              formControlName="name"
              class="form-control"
              id="machineName"
              name="machineName"
              placeholder="Machine Name"
            />
            <span *ngIf="showRequired('name', 1)" class="footnote red">* Required</span>
          </div>
          <div class="form-group theme col-md-6">
            <label for="serialNumber">Serial Number<span class="asterix">*</span></label>
            <input
              required
              type="text"
              formControlName="serialNumber"
              class="form-control"
              id="serialNumber"
              name="serialNumber"
              placeholder="Vendor Specific Unique Identifier"
            />
            <span *ngIf="showRequired('serialNumber', 1)" class="footnote red">* Required</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group theme col-md-6">
            <label for="equipment">Equipment<span class="asterix">*</span></label>
            <ng-select
              #equipmentInput
              id="equipmentInput"
              (keyup)="onEquipmentSearch($event)"
              placeholder="Add Equipment"
              loadingText="Searching..."
              [multiple]="false"
              [loading]="isEquipmentLoading"
              dropdownPosition="bottom"
              [virtualScroll]="true"
              [hideSelected]="true"
              [selectOnTab]="true"
              formControlName="equipment"
            >
              <!-- [items]="equipments" bindValue="id" bindLabel="name" -->
              <ng-container *ngFor="let item of equipments">
                <ng-option [disabled]="item.id == ''" [value]="item.id">{{ item.name }}</ng-option>
              </ng-container>
            </ng-select>
            <span *ngIf="showRequired('equipment', 3)" class="footnote red">* Required</span>
          </div>

          <div class="form-group theme col-md-6">
            <label for="material">Material<span class="asterix">*</span></label>
            <ng-select
              #materialInput
              id="materialInput"
              (keyup)="onMaterialSearch($event)"
              placeholder="Add Materials"
              loadingText="Searching..."
              [loading]="isMaterialLoading"
              [multiple]="true"
              dropdownPosition="bottom"
              [virtualScroll]="true"
              [hideSelected]="true"
              [selectOnTab]="true"
              formControlName="material"
            >
              <ng-container *ngFor="let item of materials">
                <ng-option [disabled]="item.id == ''" [value]="item.id">{{ item.name }}</ng-option>
              </ng-container>
            </ng-select>
            <span *ngIf="showRequired('material', 3)" class="footnote red">* Required</span>
          </div>
        </div>

        <div class="row">
          <div class="col-md-10 col-sm-8">
            <div class="tip">
              Note: You need to include at least one machine with related material. You may add or change machines and
              materials during and after the approval process.
            </div>
          </div>

          <div class="form-group col-md-2 col-sm-4">
            <button type="button" [disabled]="!form?.valid" (click)="add($event)" class="btn btn-white theme">
              {{ this.isUpdate ? 'Update' : 'Add' }}
            </button>
          </div>
        </div>
      </form>
      <div class="form-row" style="margin-top: 20px;">
        <div class="table theme-table">
          <div class="page-size">
            Page Size:
            <select id="page-size" [(ngModel)]="pageSize" (ngModelChange)="pageSizeChanged($event)">
              <option selected value="10">10</option>
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
            </select>
          </div>

          <ag-grid-angular
            style="height: 300px;"
            class="ag-theme-balham w-100"
            [rowData]="rowData"
            [gridOptions]="gridOptions"
          >
          </ag-grid-angular>
        </div>
      </div>
      <div class="tip">
        By clicking the SUBMIT button, you agree to be bound by the terms of the
        <a [href]="agreementUrl" target="_blank">Shopsight User Agreement</a>.
      </div>
      <div class="form-row justify-content-center align-items-center pt-4 pb-4 position-relative">
        <ng-container *ngIf="!loadingPanel; else loading">
          <div class="form-group col-md-3 container-continue m-0">
            <button
              type="button"
              [disabled]="canSubmit()"
              (click)="submitUserRegisterInfo()"
              class="btn btn-contniue theme"
            >
              Submit
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
<!-- Button trigger modal -->
<button #modal type="button" class="btn btn-primary d-none" data-toggle="modal" data-target="#machineModal"></button>

<!-- Modal -->
<div
  class="modal fade theme"
  id="machineModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="machineModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="machineModalLabel">Confirm Action</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete the machine ?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-danger" (click)="deleteMachine()">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="d-flex justify-content-center align-items-center loading-panel h-100 w-100">
    <ngx-spinner
      [name]="'spooler'"
      bdOpacity="0.7"
      bdColor="#fff"
      size="small"
      color="#74bf09"
      type="ball-clip-rotate"
      [fullScreen]="false"
    >
      <p class="m-0">Loading...</p>
    </ngx-spinner>
  </div>
</ng-template>
